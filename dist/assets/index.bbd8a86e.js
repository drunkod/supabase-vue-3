import{r as O,c as x,a as u,o as c,b as v,d as r,w as y,v as _,e as I,t as U,f as N,n as b,g as S,h as P,i as w,j as M,k as C,l as z}from"./vendor.85b55462.js";const V=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))e(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&e(l)}).observe(document,{childList:!0,subtree:!0});function s(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerpolicy&&(i.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?i.credentials="include":o.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function e(o){if(o.ep)return;o.ep=!0;const i=s(o);fetch(o.href,i)}};V();const f=O({user:{}}),E="https://s-kong-env-3017775.mircloud.ru",D="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyAgCiAgICAicm9sZSI6ICJhbm9uIiwKICAgICJpc3MiOiAic3VwYWJhc2UiLAogICAgImlhdCI6IDE2NDIxMDA0MDAsCiAgICAiZXhwIjogMTc5OTg2NjgwMAp9.rA4QhYNB7qk1iQKLggCj53GmA31XmVlw6kdOyzbKrRY",d=x(E,D);var h=(n,t)=>{const s=n.__vccOpts||n;for(const[e,o]of t)s[e]=o;return s};const j={setup(){const n=u(!1),t=u("");return{loading:n,email:t,handleLogin:async()=>{try{n.value=!0;const{error:e}=await d.auth.signIn({email:t.value});if(e)throw e;alert("Check your email for the login link!")}catch(e){alert(e.error_description||e.message)}finally{n.value=!1}}}}},J={class:"col-6 form-widget"},B=r("h1",{class:"header"},"Supabase + Vue 3",-1),K=r("p",{class:"description"},"Sign in via magic link with your email below",-1),R=["value","disabled"];function Y(n,t,s,e,o,i){return c(),v("form",{class:"row flex flex-center",onSubmit:t[1]||(t[1]=I((...l)=>e.handleLogin&&e.handleLogin(...l),["prevent"]))},[r("div",J,[B,K,r("div",null,[y(r("input",{class:"inputField",type:"email",placeholder:"Your email","onUpdate:modelValue":t[0]||(t[0]=l=>e.email=l)},null,512),[[_,e.email]])]),r("div",null,[r("input",{type:"submit",class:"button block",value:e.loading?"Loading":"Send magic link",disabled:e.loading},null,8,R)])])],32)}var q=h(j,[["render",Y]]);const T={props:{path:String},emits:["upload","update:path"],setup(n,{emit:t}){const{path:s}=U(n),e=u("10em"),o=u(!1),i=u(""),l=u(),a=async()=>{try{const{data:m,error:g}=await d.storage.from("avatars").download(s.value);if(g)throw g;i.value=URL.createObjectURL(m)}catch(m){console.error("Error downloading i2mage: ",m.message)}},p=async m=>{l.value=m.target.files;try{if(o.value=!0,!l.value||l.value.length===0)throw new Error("You must select an image to upload.");const g=l.value[0],L=g.name.split(".").pop(),A=`${`${Math.random()}.${L}`}`;let{error:k}=await d.storage.from("avatars").upload(A,g);if(k)throw k;t("update:path",A),t("upload")}catch(g){alert(g.message)}finally{o.value=!1}};return N(s,()=>{s.value&&a()}),{path:s,size:e,uploading:o,src:i,files:l,uploadAvatar:p}}},X=["src"],F={class:"button primary block",for:"single"},G=["disabled"];function Q(n,t,s,e,o,i){return c(),v("div",null,[e.src?(c(),v("img",{key:0,src:e.src,alt:"Avatar",class:"avatar image",style:b({height:e.size,width:e.size})},null,12,X)):(c(),v("div",{key:1,class:"avatar no-image",style:b({height:e.size,width:e.size})},null,4)),r("div",{style:b({width:e.size})},[r("label",F,S(e.uploading?"Uploading ...":"Upload"),1),r("input",{style:{visibility:"hidden",position:"absolute"},type:"file",id:"single",accept:"image/*",onChange:t[0]||(t[0]=(...l)=>e.uploadAvatar&&e.uploadAvatar(...l)),disabled:e.uploading},null,40,G)],4)])}var W=h(T,[["render",Q]]);const Z={components:{Avatar:W},setup(){const n=u(!0),t=u(""),s=u(""),e=u("");async function o(){try{n.value=!0,f.user=d.auth.user();let{data:a,error:p,status:m}=await d.from("profiles").select("username, website, avatar_url").eq("id",f.user.id).single();if(p&&m!==406)throw p;a&&(t.value=a.username,s.value=a.website,e.value=a.avatar_url)}catch(a){alert(a.message)}finally{n.value=!1}}async function i(){try{n.value=!0,f.user=d.auth.user();const a={id:f.user.id,username:t.value,website:s.value,avatar_url:e.value,updated_at:new Date};let{error:p}=await d.from("profiles").upsert(a,{returning:"minimal"});if(p)throw p}catch(a){alert(a.message)}finally{n.value=!1}}async function l(){try{n.value=!0;let{error:a}=await d.auth.signOut();if(a)throw a}catch(a){alert(a.message)}finally{n.value=!1}}return P(()=>{o()}),{store:f,loading:n,username:t,website:s,avatar_url:e,updateProfile:i,signOut:l}}},H=r("label",{for:"email"},"Email",-1),$=["value"],ee=r("label",{for:"username"},"Name",-1),te=r("label",{for:"website"},"Website",-1),ae=["value","disabled"],oe=["disabled"];function re(n,t,s,e,o,i){const l=w("Avatar");return c(),v("form",{class:"form-widget",onSubmit:t[4]||(t[4]=I((...a)=>e.updateProfile&&e.updateProfile(...a),["prevent"]))},[r("div",null,[H,r("input",{id:"email",type:"text",value:e.store.user.email,disabled:""},null,8,$)]),r("div",null,[ee,y(r("input",{id:"username",type:"text","onUpdate:modelValue":t[0]||(t[0]=a=>e.username=a)},null,512),[[_,e.username]])]),r("div",null,[te,y(r("input",{id:"website",type:"website","onUpdate:modelValue":t[1]||(t[1]=a=>e.website=a)},null,512),[[_,e.website]])]),M(l,{path:e.avatar_url,"onUpdate:path":t[2]||(t[2]=a=>e.avatar_url=a),onUpload:e.updateProfile},null,8,["path","onUpload"]),r("div",null,[r("input",{type:"submit",class:"button block primary",value:e.loading?"Loading ...":"Update",disabled:e.loading},null,8,ae)]),r("div",null,[r("button",{class:"button block",onClick:t[3]||(t[3]=(...a)=>e.signOut&&e.signOut(...a)),disabled:e.loading}," Sign Out ",8,oe)])],32)}var ne=h(Z,[["render",re]]);const le={components:{Auth:q,Profile:ne},setup(){return f.user=d.auth.user(),d.auth.onAuthStateChange((n,t)=>{f.user=t.user}),{store:f}}},ie={class:"container",style:{padding:"50px 0 100px 0"}};function se(n,t,s,e,o,i){const l=w("Profile"),a=w("Auth");return c(),v("div",ie,[e.store.user?(c(),C(l,{key:0})):(c(),C(a,{key:1}))])}var ue=h(le,[["render",se]]);z(ue).mount("#app");
